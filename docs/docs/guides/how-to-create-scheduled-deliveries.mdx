import ThreeDotMenu from './assets/scheduled-deliveries-three-dot-menu.png';
import CreateNewModal from './assets/create-new-modal.png';
import ConfigureNewDelivery from './assets/configure-scheduled-delivery.png';
import EditDeleteDelivery from './assets/edit-delete-scheduled-delivery.png';
import ScheduledDeliveriesOverview from './assets/scheduled-deliveries-overview.jpg';
import PrivateSlackChannel from './assets/private-slack-channel.png';
import GsheetMetadata from './assets/gsheet-metadata.png';
import GsheeDelivery from './assets/gsheet-delivery.png';

# Scheduled deliveries

Scheduled deliveries let you send a dashboard or saved chart, and their results to people via email or Slack - even to people who don't have an account in your Lightdash instance.

If your Lightdash organization has email or [Slack](/guides/sharing-in-slack.mdx#adding-slack-to-your-organization-lightdash-cloud) set up, you can create or select an existing saved chart or dashboard, add a scheduled delivery to it, and tell Lightdash when you’d like the send out your update. You can set up as many scheduled deliveries to a saved chart or dashboard as you like, and if you make any changes to the content, Lightdash will update the scheduled deliveries the next time they’re sent.

If you are running Lightdash on self-host, make sure you have the [headless browser](https://docs.lightdash.com/self-host/customize-deployment/enable-headless-browser-for-lightdash) to generate images. 

:::info
For security reasons, the delivered files expire after 3 days. This means old emails or Slack shares will have broken images and there is not an option to retrieve them. If you want to keep the sent files, it's best to download them from the scheduled delivery.
:::

## Enabling scheduled deliveries

To use scheduled deliveries, an organization admin needs to have set up Slack or email for your Lightdash instance. 

To set up Slack, see [setting up Slack](/guides/sharing-in-slack.mdx#adding-slack-to-your-organization-lightdash-cloud). If you're not on a self-hosted instance (e.g. Cloud or Enterprise), then your instance comes with an email server already set up, so you don't need to do anything to enable email deliveries. If you're on a self-hosted instance, see [setting up email](https://docs.lightdash.com/references/environmentVariables#:~:text=postgres%20environment%20variables-,SMTP%20environment%20variables,-This%20is%20a) to configure a Lightdash email client.

## Creating a scheduled delivery

Only users with [admin or edit access](/references/roles.mdx) can create scheduled deliveries. To create a scheduled delivery, click on the three-dot menu in the top-right corner of your chart or dashboard, then click on `scheduled deliveries`.

<img src={ThreeDotMenu} width="818" height="276" style={{display: "block", margin: "0 auto 20px auto"}}/>

You'll get a modal that pops up and shows you the list of existing scheduled deliveries for your saved chart or dashboard, and gives you the option to `create new`.

<img src={CreateNewModal} width="942" height="605" style={{display: "block", margin: "0 auto 20px auto"}}/>

If you click on `create new`, you'll be brought to a configuration screen for your new scheduled delivery.

<img src={ConfigureNewDelivery} width="541" height="745" style={{display: "block", margin: "0 auto 20px auto"}}/>

## Scheduled delivery options

- **Name**: this is the name of your scheduled delivery. 
- **Frequency**: this is how often your scheduled delivery will be sent. You can make this hourly, daily, weekly, monthly, or custom - each frequency has its own options. For example, with a monthly schedule, you set the day of the month and the time that you want your scheduled delivery to be sent. The custom frequency lets you write out your own custom Cron expression if you need something more specific than our standard options. All times for the scheduler are in UTC.
- **Format**: either `Image`, `CSV` or `Google Sheets`. `Image` sends an image of the content (chart or dashboard) to your chosen destination. `CSV` sends a downloadable .csv file of the results table from your chart, or if you're sending a dashboard, it sends a single message with multiple .csv files for the results tables from each of your charts.
    - **For CSV formats**: you can set the `values` to either be `raw` (we remove the formatting applied dates, numbers, or other fields in Lightdash) or `formatted` (the way the values appear in your table in Lightdash is how they'll appear in the .csv). You can also adjust the `limit` and specify the number of rows that you want to be delivered in your .csv. `Results in table` will deliver the number of results that are currently in the results table for your charts. You can also set a custom number of rows to be delivered using `custom`, or set all results to be delivered so there's no maximum row limit for each chart using `all results`. 
    - **Limit on CSV format**: We limit CSV downloads to 100,000 cells by default, so if you are trying to download more cells, your file will get truncated.
- **Send to**: here, you can pick if you want to send your scheduled delivery to Slack, email, or both. You can add as many Slack channels and email addresses as you'd like to here. You can send a scheduled delivery to a person in Slack using `@persons-name` or to a channel using `#channel-name`.

Once you've set up all of your delivery options, you can click `create new` to create your new scheduled delivery.

## Uploading data to Google Sheets

This option requires [Google SSO](https://docs.lightdash.com/self-host/customize-deployment/use-sso-login-for-self-hosted-lightdash#google) to be configured on the server. 

If you want to enable this option on self hosting, visit [Google Sheet integration](https://docs.lightdash.com/self-host/customize-deployment/configure-a-slack-app-for-lightdash) to find how to configure Lightdash. 

You can configure a scheduled delivery for `chats` or `dashboards` to upload data to an existing spreadhseet in Google Sheets. 

First selec the format `Google Sheets` then click on `+ Add to Google Sheets`.

If this is the first time you upload a Google Sheet, you will see an authentication popup where you can select your Google account to have access to your files. 

Once you're logged in, you can select the file you want to write into. 

<img src={GsheetDelivery} width="500" height="515" style={{display: "block", margin: "0 auto 20px auto"}}/>

If you are uploading data from a chart, the data will be uploaded to the first tab in your selected Google Spreadsheet and it will overwrite all the content. 

If you are uploading data from a dashboard, we will create as many tabs as charts in your dashboard.

Aditionally, for both `charts` and `dashboards` we will create a `metadata` tab in the Google spreadsheet with the information about the type and additionally how many tabs were uploaded if a dashboard was selected 

<img src={GsheetMetadata} width="845" height="515" style={{display: "block", margin: "0 auto 20px auto"}}/>


## Editing and deleting your scheduled deliveries

To remove a scheduled delivery from a chart or dashboard, click on the three-dot-menu beside the scheduled delivery name. From there, you can choose to `edit` or `delete` the scheduled delivery.

<img src={EditDeleteDelivery} width="845" height="515" style={{display: "block", margin: "0 auto 20px auto"}}/>

## Overview of your scheduled deliveries

Users who have an admin role in your project can access an overview of your scheduled deliveries in the project settings. 

In the scheduled deliveries overview page, you can see a list of all of your scheduled deliveries, their most recent delivery status, and a history of all of the previous scheduled deliveries in your project. 

To access the overview page, just head to your project settings, then to the `scheduled deliveries` tab. 

<img src={ScheduledDeliveriesOverview} width="1086" height="589" style={{display: "block", margin: "0 auto 20px auto"}}/>

## Sending to private Slack channels 

You can also send scheduled deliveries to private Slack channels. To do this, simply type the name of the Slack channel exactly as it appears in Slack into the input text box. Then click on it to confirm and save the scheduled delivery. 

:::info
You must add the Lightdash slack bot into the private Slack channel for it to be able to post scheduled delivery results. 
:::

<img src={PrivateSlackChannel} width="818" height="276" style={{display: "block", margin: "0 auto 20px auto"}}/>
